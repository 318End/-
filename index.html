<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸°æ™Ÿä¾›åº”é“¾ - ä»»åŠ¡çœ‹æ¿</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            margin-bottom: 15px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .header-left {
            flex: 1;
        }

        .header h1 {
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .header h1:hover {
            transform: translateX(2px);
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
        }

        .header-subtitle {
            font-size: 0.75em;
            opacity: 0.9;
            margin-top: 5px;
            font-weight: 400;
            letter-spacing: 1px;
        }

        .header-right {
            text-align: right;
        }

        .datetime {
            font-size: 1.2em;
            font-weight: 600;
        }

        .date {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        /* ä¸‰ä¸ªæŒ‰é’®ä¸åŒçš„UIæ ·å¼ */
        .btn-add-task {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-add-task:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }

        .btn-add-person {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-add-person:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);
        }

        .btn-export {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(108, 117, 125, 0.4);
        }

        .month-selector {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .month-selector:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .save-status {
            font-size: 0.85em;
            color: #90EE90;
            margin-top: 5px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #8B0000;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #8B0000;
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .category-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .category-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .category-count {
            background: #8B0000;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
        }

        /* å¯æ‹–æ‹½è°ƒæ•´é«˜åº¦çš„ä»»åŠ¡å®¹å™¨ */
        .tasks-container {
            min-height: 300px;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
            resize: vertical;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .tasks-container:hover {
            border-color: #dee2e6;
        }

        .task-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #ddd;
        }

        .task-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        /* ä»»åŠ¡å‰©ä½™æ—¶é—´é¢œè‰² */
        .task-card.days-green {
            border-left-color: #28a745;
            background: linear-gradient(90deg, #f0fff4 0%, white 30%);
        }

        .task-card.days-yellow {
            border-left-color: #ffc107;
            background: linear-gradient(90deg, #fffbeb 0%, white 30%);
        }

        .task-card.days-red {
            border-left-color: #dc3545;
            border-left-width: 5px;
            background: linear-gradient(90deg, #ffcccc 0%, white 30%);
            box-shadow: 0 2px 10px rgba(220, 53, 69, 0.25);
        }

        .task-card.days-overdue {
            border-left-color: #dc3545;
            border-left-width: 6px;
            background: #ffb3b3;
            box-shadow: 0 3px 12px rgba(220, 53, 69, 0.3);
        }

        .task-card.days-overdue .task-content {
            color: #721c24;
            font-weight: 600;
        }

        .task-card.days-overdue .task-deadline {
            color: #721c24 !important;
            font-weight: bold;
        }

        .task-card.days-overdue .member-badge {
            background: rgba(255, 255, 255, 0.8);
            color: #721c24;
            border: 1px solid #dc3545;
        }

        .task-card.days-overdue .member-badge.completed {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        /* ä»»åŠ¡å†…å®¹è‡ªåŠ¨æ¢è¡Œ */
        .task-content {
            font-size: 16px;
            margin-bottom: 10px;
            word-wrap: break-word;
            word-break: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
            cursor: pointer;
            font-weight: 500;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 12px;
            color: #666;
        }

        .task-members {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .member-badge {
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: #495057;
        }

        .member-badge.completed {
            background: #28a745;
            color: white;
        }

        .member-badge.admin {
            background: #6c757d;
            color: white;
        }

        .task-deadline {
            font-weight: 600;
        }

        .task-deadline.days-green {
            color: #28a745;
        }

        .task-deadline.days-yellow {
            color: #ffc107;
        }

        .task-deadline.days-red {
            color: #dc3545;
        }

        .task-deadline.days-overdue {
            color: #8B0000;
            font-weight: bold;
        }

        /* äººå‘˜å®ŒæˆçŠ¶æ€å±•ç¤º - åœ¨è¯¦æƒ…å¼¹çª—ä¸­ */
        .member-completion {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .member-completion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid #e9ecef;
        }

        .member-completion-item:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .member-completion-item.completed {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .member-completion-checkbox {
            cursor: pointer;
            width: 18px;
            height: 18px;
            margin: 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #333;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .member-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }

        .member-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .member-checkbox:hover {
            background: #e9ecef;
        }

        .member-checkbox input {
            width: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        .task-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .task-detail-actions .btn {
            flex: 1;
        }

        .ranking-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .ranking-title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .rank-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .rank-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .rank-number {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3em;
            flex-shrink: 0;
        }

        .rank-1 { 
            background: linear-gradient(135deg, #FFD700, #FFA500); 
            color: white;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }
        .rank-2 { 
            background: linear-gradient(135deg, #C0C0C0, #808080); 
            color: white;
            box-shadow: 0 4px 12px rgba(192, 192, 192, 0.4);
        }
        .rank-3 { 
            background: linear-gradient(135deg, #CD7F32, #8B4513); 
            color: white;
            box-shadow: 0 4px 12px rgba(205, 127, 50, 0.4);
        }
        .rank-other { 
            background: #e0e0e0; 
            color: #666; 
        }

        .rank-info {
            flex: 1;
        }

        .rank-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 4px;
        }

        .rank-stats {
            font-size: 0.9em;
            color: #666;
        }

        .rank-count {
            font-size: 1.8em;
            font-weight: bold;
            color: #8B0000;
        }

        /* é”€å”®çœ‹æ¿æ ·å¼ */
        .sales-table {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .sales-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .sales-table th,
        .sales-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .sales-table th {
            background: #8B0000;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .sales-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .sales-table input {
            width: 80px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-good {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* äººå‘˜åˆ—è¡¨æ ·å¼ */
        .person-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .person-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .person-name {
            font-weight: 600;
        }

        .admin-tag {
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .person-actions {
            display: flex;
            gap: 8px;
        }

        @media (max-width: 1200px) {
            .board-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .board-grid {
                grid-template-columns: 1fr;
            }
            
            .header-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1 id="boardTitle" onclick="editBoardTitle()">ğŸš€ ä¸°æ™Ÿä¾›åº”é“¾æ™ºèƒ½çœ‹æ¿</h1>
                <div class="header-subtitle">é«˜æ•ˆåä½œ Â· æ¸…æ™°è¿½è¸ª Â· å¿«é€Ÿè¾¾æˆ</div>
            </div>
            <div class="header-right">
                <div class="datetime" id="datetime"></div>
                <div class="date" id="date"></div>
                <div class="header-actions">
                    <button class="btn-add-task" onclick="openAddTaskModal()">â• æ·»åŠ ä»»åŠ¡</button>
                    <button class="btn-add-person" onclick="openAddPersonModal()">ğŸ‘¤ æ·»åŠ äººå‘˜</button>
                    <button class="btn-export" onclick="exportToHTML()">ğŸ’¾ å¯¼å‡ºå¤‡ä»½</button>
                    <select class="month-selector" id="monthSelector" onchange="switchMonth()">
                        <option value="current">å½“å‰æœˆä»½</option>
                    </select>
                </div>
                <div class="save-status" id="saveStatus">å‡†å¤‡å°±ç»ª...</div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('tasks')">ğŸ“‹ ä»»åŠ¡çœ‹æ¿</button>
            <button class="nav-tab" onclick="switchPage('ranking')">ğŸ† ä»»åŠ¡æ’è¡Œ</button>
            <button class="nav-tab" onclick="switchPage('sales')">ğŸ’° é”€å”®çœ‹æ¿</button>
            <button class="nav-tab" onclick="switchPage('analysis')">ğŸ“Š é”€å”®åˆ†æ</button>
        </div>

        <!-- ä»»åŠ¡çœ‹æ¿ -->
        <div class="page active" id="tasksPage">
            <div class="stats-bar">
                <div class="stat-card" onclick="showFilteredTasks('all')">
                    <div class="stat-label">æ€»ä»»åŠ¡</div>
                    <div class="stat-value" id="totalTasks">0</div>
                </div>
                <div class="stat-card" onclick="showFilteredTasks('urgent')">
                    <div class="stat-label">ç´§æ€¥ä»»åŠ¡</div>
                    <div class="stat-value" id="urgentTasks">0</div>
                </div>
                <div class="stat-card" onclick="showFilteredTasks('important')">
                    <div class="stat-label">é‡è¦ä»»åŠ¡</div>
                    <div class="stat-value" id="importantTasks">0</div>
                </div>
                <div class="stat-card" onclick="showFilteredTasks('normal')">
                    <div class="stat-label">æ™®é€šä»»åŠ¡</div>
                    <div class="stat-value" id="normalTasks">0</div>
                </div>
                <div class="stat-card" onclick="showFilteredTasks('completed')">
                    <div class="stat-label">å·²å®Œæˆ</div>
                    <div class="stat-value" id="completedTasks">0</div>
                </div>
                <div class="stat-card" onclick="showFilteredTasks('overdue')">
                    <div class="stat-label">é€¾æœŸä»»åŠ¡</div>
                    <div class="stat-value" style="color: #dc3545;" id="overdueTasks">0</div>
                </div>
            </div>

            <div class="board-grid">
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">ğŸ”¥ ç´§æ€¥</div>
                        <span class="category-count" id="urgentCount">0</span>
                    </div>
                    <div class="tasks-container" id="urgentContainer"></div>
                </div>

                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">â­ é‡è¦</div>
                        <span class="category-count" id="importantCount">0</span>
                    </div>
                    <div class="tasks-container" id="importantContainer"></div>
                </div>

                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">ğŸ“ ä»»åŠ¡</div>
                        <span class="category-count" id="normalCount">0</span>
                    </div>
                    <div class="tasks-container" id="normalContainer"></div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡æ’è¡Œ -->
        <div class="page" id="rankingPage">
            <div class="ranking-section">
                <h2 class="ranking-title">ğŸ† ä»»åŠ¡å®Œæˆæ’è¡Œæ¦œ</h2>
                <div id="taskRankingList"></div>
            </div>
        </div>

        <!-- é”€å”®çœ‹æ¿ -->
        <div class="page" id="salesPage">
            <div class="sales-table">
                <div style="margin-bottom: 15px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                    <label>å½“å‰å¤©æ•°: <input type="number" id="currentDay" value="1" min="1" max="31" style="width: 80px;" onchange="calculateSales()"></label>
                    <label>æ€»å¤©æ•°: <input type="number" id="totalDays" value="30" min="1" max="31" style="width: 80px;" onchange="calculateSales()"></label>
                    <button class="btn btn-primary" onclick="calculateSales()">ğŸ”„ åˆ·æ–°</button>
                    <button class="btn btn-success" onclick="openSelectSalesMembersModal()">ğŸ‘¥ é€‰æ‹©æˆå‘˜</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>æˆå‘˜</th>
                            <th>ç›®æ ‡</th>
                            <th>è®¢å•</th>
                            <th>å‡ºè´§</th>
                            <th>é€€è´§</th>
                            <th>å‡€é”€å”®é¢</th>
                            <th>å®Œæˆç‡</th>
                            <th>å‰©ä½™</th>
                            <th>æ—¥å‡</th>
                            <th>çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="salesBody"></tbody>
                    <tfoot>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td>æ€»è®¡</td>
                            <td id="totalTarget">0</td>
                            <td id="totalOrder">0</td>
                            <td id="totalOutbound">0</td>
                            <td id="totalReturn">0</td>
                            <td id="totalNet">0</td>
                            <td id="totalRate">0%</td>
                            <td colspan="4"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- é”€å”®åˆ†æ -->
        <div class="page" id="analysisPage">
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-label">æœ€é«˜å®Œæˆç‡</div>
                    <div class="stat-value" id="maxRate">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å¹³å‡å®Œæˆç‡</div>
                    <div class="stat-value" id="avgRate">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">è¾¾æ ‡äººæ•°</div>
                    <div class="stat-value" id="achievedCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å›¢é˜Ÿæ€»å®Œæˆç‡</div>
                    <div class="stat-value" id="teamRate">0%</div>
                </div>
            </div>

            <div class="ranking-section">
                <h2 class="ranking-title">ğŸ“‹ é”€å”®æ’è¡Œæ¦œ</h2>
                <div id="salesRankingList"></div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="addTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ·»åŠ ä»»åŠ¡</h2>
                <button class="modal-close" onclick="closeAddTaskModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>ä»»åŠ¡å†…å®¹</label>
                <textarea id="taskContent" placeholder="è¯·è¾“å…¥ä»»åŠ¡å†…å®¹"></textarea>
            </div>
            <div class="form-group">
                <label>æˆªæ­¢æ—¥æœŸ</label>
                <input type="date" id="taskDeadline">
            </div>
            <div class="form-group">
                <label>ä»»åŠ¡ç±»åˆ«</label>
                <select id="taskCategory">
                    <option value="normal">ğŸ“ æ™®é€šä»»åŠ¡</option>
                    <option value="important">â­ é‡è¦ä»»åŠ¡</option>
                    <option value="urgent">ğŸ”¥ ç´§æ€¥ä»»åŠ¡</option>
                </select>
            </div>
            <div class="form-group">
                <label>è´Ÿè´£äººï¼ˆå¯å¤šé€‰ï¼‰</label>
                <div class="member-selector" id="memberSelector"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveNewTask()">ä¿å­˜</button>
                <button class="btn" onclick="closeAddTaskModal()" style="background: #6c757d; color: white;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="taskDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ä»»åŠ¡è¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeTaskDetailModal()">Ã—</button>
            </div>
            <div id="taskDetailContent"></div>
            <div class="task-detail-actions">
                <button class="btn btn-success" onclick="completeAllTask()">âœ“ å®Œæˆä»»åŠ¡</button>
                <button class="btn btn-primary" onclick="editCurrentTask()">âœ ç¼–è¾‘</button>
                <button class="btn btn-danger" onclick="deleteCurrentTask()">ğŸ—‘ åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ äººå‘˜æ¨¡æ€æ¡† -->
    <div class="modal" id="addPersonModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">äººå‘˜ç®¡ç†</h2>
                <button class="modal-close" onclick="closeAddPersonModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>æ·»åŠ æ–°äººå‘˜</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newPersonName" placeholder="è¯·è¾“å…¥å§“å" style="flex: 1;">
                    <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                        <input type="checkbox" id="newPersonIsAdmin">
                        <span>ç®¡ç†å‘˜</span>
                    </label>
                    <button class="btn btn-primary" onclick="addNewPerson()">æ·»åŠ </button>
                </div>
            </div>
            <div class="form-group">
                <label>ç°æœ‰äººå‘˜</label>
                <div id="existingPersonsList" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- é€‰æ‹©é”€å”®çœ‹æ¿æˆå‘˜æ¨¡æ€æ¡† -->
    <div class="modal" id="selectSalesMembersModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">é€‰æ‹©é”€å”®çœ‹æ¿æˆå‘˜</h2>
                <button class="modal-close" onclick="closeSelectSalesMembersModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label>è¯·é€‰æ‹©è¦åœ¨é”€å”®çœ‹æ¿ä¸­æ˜¾ç¤ºçš„æˆå‘˜</label>
                <div id="salesMembersSelector" class="member-selector"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveSalesMembers()">ä¿å­˜</button>
                <button class="btn" onclick="closeSelectSalesMembersModal()" style="background: #6c757d; color: white;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ä»»åŠ¡åˆ—è¡¨æ¨¡æ€æ¡† -->
    <div class="modal" id="taskListModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title" id="listModalTitle">ä»»åŠ¡åˆ—è¡¨</h2>
                <button class="modal-close" onclick="closeTaskListModal()">Ã—</button>
            </div>
            <div id="taskListContent" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        /* DATA_INJECTION_POINT_START */
        // è¿™é‡Œæ˜¯æ•°æ®æ³¨å…¥ç‚¹ï¼Œå¯¼å‡ºæ—¶ä¼šè¢«æ›¿æ¢
        let injectedData = null;
        /* DATA_INJECTION_POINT_END */
        
        let appData = {
            currentMonth: getCurrentMonth(),
            months: {},
            members: [
                {name: 'å¼ ä¸‰', isAdmin: false},
                {name: 'æå››', isAdmin: false},
                {name: 'ç‹äº”', isAdmin: false},
                {name: 'èµµå…­', isAdmin: false},
                {name: 'é’±ä¸ƒ', isAdmin: false}
            ],
            salesMembers: [], // é”€å”®çœ‹æ¿æ˜¾ç¤ºçš„æˆå‘˜
            boardTitle: 'ğŸš€ ä¸°æ™Ÿä¾›åº”é“¾æ™ºèƒ½çœ‹æ¿' // çœ‹æ¿æ ‡é¢˜
        };
        
        let currentViewMonth = 'current';
        let currentTask = null;

        function getCurrentMonth() {
            const d = new Date();
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
        }

        function initMonthData() {
            const month = appData.currentMonth;
            if (!appData.months[month]) {
                appData.months[month] = {
                    tasks: [],
                    salesData: [],
                    currentDay: 1,
                    totalDays: 30
                };
            }
        }

        function getCurrentData() {
            if (currentViewMonth === 'current') {
                return appData.months[appData.currentMonth];
            } else {
                return appData.months[currentViewMonth];
            }
        }

        // åˆå§‹åŒ–
        function init() {
            loadData();
            initMonthData();
            renderBoardTitle();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateMonthSelector();
            renderTasks();
            renderSales();
            renderMemberSelector();
            
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡ä¿å­˜ä»¥æ˜¾ç¤ºçŠ¶æ€
            autoSave();
            
            // è‡ªåŠ¨ä¿å­˜æ”¹ä¸º30ç§’
            setInterval(autoSave, 30000);
            window.addEventListener('beforeunload', autoSave);
            
            // æ£€æŸ¥æœˆåº¦åˆ‡æ¢
            setInterval(checkMonthChange, 60000);
        }

        function updateDateTime() {
            const now = new Date();
            document.getElementById('datetime').textContent = now.toLocaleTimeString('zh-CN');
            document.getElementById('date').textContent = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
        }

        function checkMonthChange() {
            const newMonth = getCurrentMonth();
            if (newMonth !== appData.currentMonth) {
                appData.currentMonth = newMonth;
                initMonthData();
                if (currentViewMonth === 'current') {
                    renderTasks();
                    renderSales();
                }
                updateMonthSelector();
                saveData();
            }
        }

        function updateMonthSelector() {
            const selector = document.getElementById('monthSelector');
            const months = Object.keys(appData.months).sort().reverse();
            selector.innerHTML = '<option value="current">å½“å‰æœˆä»½ (' + appData.currentMonth + ')</option>' +
                months.filter(m => m !== appData.currentMonth).map(m => 
                    `<option value="${m}">${m}</option>`
                ).join('');
        }

        function switchMonth() {
            currentViewMonth = document.getElementById('monthSelector').value === 'current' 
                ? 'current' 
                : document.getElementById('monthSelector').value;
            renderTasks();
            renderSales();
            renderTaskRanking();
        }

        // æ•°æ®ä¿å­˜ - å¢å¼ºå®‰å…¨æ€§
        function saveData() {
            try {
                const dataStr = JSON.stringify(appData);
                
                // ä¸»å­˜å‚¨
                localStorage.setItem('fengsheng_data', dataStr);
                
                // ä¸‰é‡å¤‡ä»½
                localStorage.setItem('fengsheng_backup_1', dataStr);
                localStorage.setItem('fengsheng_backup_2', dataStr);
                localStorage.setItem('fengsheng_backup_3', dataStr);
                
                // æ—¶é—´æˆ³å¤‡ä»½ï¼ˆç”¨äºæ¢å¤ï¼‰
                const timestamp = new Date().toISOString();
                localStorage.setItem('fengsheng_last_save', timestamp);
                
                // æ¯å°æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¤‡ä»½ç‚¹
                const currentHour = new Date().getHours();
                const lastBackupHour = localStorage.getItem('fengsheng_last_backup_hour');
                if (lastBackupHour !== String(currentHour)) {
                    localStorage.setItem('fengsheng_hourly_backup', dataStr);
                    localStorage.setItem('fengsheng_last_backup_hour', String(currentHour));
                }
                
                return true;
            } catch (e) {
                console.error('ä¿å­˜å¤±è´¥', e);
                // å¦‚æœlocalStorageæ»¡äº†ï¼Œå°è¯•æ¸…ç†æ—§æ•°æ®
                if (e.name === 'QuotaExceededError') {
                    try {
                        localStorage.removeItem('fengsheng_backup_3');
                        localStorage.setItem('fengsheng_data', JSON.stringify(appData));
                        return true;
                    } catch (e2) {
                        console.error('æ¸…ç†åä»ä¿å­˜å¤±è´¥', e2);
                        return false;
                    }
                }
                return false;
            }
        }

        function loadData() {
            try {
                // ä¼˜å…ˆä½¿ç”¨æ³¨å…¥çš„æ•°æ®ï¼ˆä»å¯¼å‡ºçš„HTMLæ–‡ä»¶ä¸­ï¼‰
                if (injectedData) {
                    appData = { ...appData, ...injectedData };
                    console.log('ä½¿ç”¨å¯¼å‡ºæ–‡ä»¶ä¸­çš„æ•°æ®');
                    return;
                }
                
                // å°è¯•ä»å¤šä¸ªå¤‡ä»½æºåŠ è½½
                const saved = localStorage.getItem('fengsheng_data') || 
                             localStorage.getItem('fengsheng_backup_1') || 
                             localStorage.getItem('fengsheng_backup_2') ||
                             localStorage.getItem('fengsheng_backup_3') ||
                             localStorage.getItem('fengsheng_hourly_backup');
                             
                if (saved) {
                    const loaded = JSON.parse(saved);
                    // å…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®
                    if (loaded.members && loaded.members.length > 0 && typeof loaded.members[0] === 'string') {
                        loaded.members = loaded.members.map(name => ({name, isAdmin: false}));
                    }
                    appData = { ...appData, ...loaded };
                    
                    // å¦‚æœæ²¡æœ‰salesMembersï¼Œåˆå§‹åŒ–ä¸ºæ‰€æœ‰éç®¡ç†å‘˜
                    if (!appData.salesMembers || appData.salesMembers.length === 0) {
                        appData.salesMembers = appData.members.filter(m => !m.isAdmin).map(m => m.name);
                    }
                    
                    console.log('æ•°æ®åŠ è½½æˆåŠŸï¼Œæœ€åä¿å­˜æ—¶é—´:', localStorage.getItem('fengsheng_last_save'));
                } else {
                    console.log('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                }
            } catch (e) {
                console.error('åŠ è½½å¤±è´¥', e);
                alert('æ•°æ®åŠ è½½å¤±è´¥ï¼Œå¯èƒ½æ•°æ®æŸåã€‚ç³»ç»Ÿå°†ä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚\nå»ºè®®ï¼šå¦‚æœæ‚¨æœ‰å¯¼å‡ºçš„HTMLå¤‡ä»½æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨å¤‡ä»½æ–‡ä»¶ã€‚');
            }
        }

        function autoSave() {
            if (saveData()) {
                const now = new Date();
                document.getElementById('saveStatus').textContent = 'âœ“ æœ€åä¿å­˜: ' + now.toLocaleTimeString('zh-CN');
            } else {
                document.getElementById('saveStatus').textContent = 'âœ— ä¿å­˜å¤±è´¥';
            }
        }

        // å¯¼å‡ºæ•°æ®åˆ°HTMLæ–‡ä»¶
        function exportToHTML() {
            try {
                // å…ˆä¿å­˜å½“å‰æ•°æ®
                saveData();
                
                // è·å–å½“å‰HTMLå†…å®¹
                let htmlContent = document.documentElement.outerHTML;
                
                // å°†å½“å‰æ•°æ®åºåˆ—åŒ–ä¸ºJavaScriptä»£ç 
                const dataString = JSON.stringify(appData, null, 2);
                const injectionCode = `/* DATA_INJECTION_POINT_START */
        // å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString('zh-CN')}
        // è¿™ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥åœ¨ä»»ä½•æµè§ˆå™¨ä¸­æ‰“å¼€
        let injectedData = ${dataString};
        /* DATA_INJECTION_POINT_END */`;
                
                // æ›¿æ¢æ•°æ®æ³¨å…¥ç‚¹
                const regex = /\/\* DATA_INJECTION_POINT_START \*\/[\s\S]*?\/\* DATA_INJECTION_POINT_END \*\//;
                htmlContent = htmlContent.replace(regex, injectionCode);
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                const now = new Date();
                const filename = `ä¸°æ™Ÿçœ‹æ¿_å¤‡ä»½_${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}.html`;
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // é‡Šæ”¾URLå¯¹è±¡
                URL.revokeObjectURL(link.href);
                
                alert('âœ“ æ•°æ®å·²æˆåŠŸå¯¼å‡ºåˆ°HTMLæ–‡ä»¶ï¼\n\næ–‡ä»¶å: ' + filename + '\n\næ­¤æ–‡ä»¶åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥åœ¨ä»»ä½•ç”µè„‘ã€ä»»ä½•æµè§ˆå™¨ä¸­æ‰“å¼€ä½¿ç”¨ã€‚\nè¯·å¦¥å–„ä¿å­˜æ­¤å¤‡ä»½æ–‡ä»¶ï¼');
            } catch (e) {
                console.error('å¯¼å‡ºå¤±è´¥', e);
                alert('âœ— å¯¼å‡ºå¤±è´¥: ' + e.message + '\n\nè¯·é‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ');
            }
        }

        // é¡µé¢åˆ‡æ¢
        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(page + 'Page').classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'ranking') renderTaskRanking();
            if (page === 'analysis') renderSalesAnalysis();
        }

        // ç¼–è¾‘çœ‹æ¿æ ‡é¢˜
        function editBoardTitle() {
            const currentTitle = appData.boardTitle || 'ğŸš€ ä¸°æ™Ÿä¾›åº”é“¾æ™ºèƒ½çœ‹æ¿';
            const newTitle = prompt('è¯·è¾“å…¥æ–°çš„çœ‹æ¿æ ‡é¢˜ï¼š', currentTitle);
            
            if (newTitle !== null && newTitle.trim() !== '') {
                appData.boardTitle = newTitle.trim();
                document.getElementById('boardTitle').textContent = newTitle.trim();
                saveData();
            }
        }

        // æ¸²æŸ“çœ‹æ¿æ ‡é¢˜
        function renderBoardTitle() {
            if (appData.boardTitle) {
                document.getElementById('boardTitle').textContent = appData.boardTitle;
            }
        }

        // äººå‘˜ç®¡ç†
        function openAddPersonModal() {
            renderExistingPersons();
            document.getElementById('addPersonModal').classList.add('active');
        }

        function closeAddPersonModal() {
            document.getElementById('addPersonModal').classList.remove('active');
        }

        function renderExistingPersons() {
            const container = document.getElementById('existingPersonsList');
            container.innerHTML = appData.members.map((member, index) => `
                <div class="person-item">
                    <div class="person-info">
                        <span class="person-name">${member.name}</span>
                        ${member.isAdmin ? '<span class="admin-tag">ç®¡ç†å‘˜</span>' : ''}
                    </div>
                    <div class="person-actions">
                        <button class="btn ${member.isAdmin ? 'btn-primary' : 'btn-success'}" 
                                style="padding: 4px 12px; font-size: 12px;" 
                                onclick="toggleAdmin(${index})">
                            ${member.isAdmin ? 'å–æ¶ˆç®¡ç†å‘˜' : 'è®¾ä¸ºç®¡ç†å‘˜'}
                        </button>
                        <button class="btn btn-danger" 
                                style="padding: 4px 12px; font-size: 12px;" 
                                onclick="removePerson(${index})">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addNewPerson() {
            const name = document.getElementById('newPersonName').value.trim();
            const isAdmin = document.getElementById('newPersonIsAdmin').checked;
            
            if (!name) {
                alert('è¯·è¾“å…¥å§“å');
                return;
            }
            if (appData.members.some(m => m.name === name)) {
                alert('è¯¥äººå‘˜å·²å­˜åœ¨');
                return;
            }
            
            appData.members.push({name, isAdmin});
            
            // å¦‚æœä¸æ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ åˆ°é”€å”®çœ‹æ¿æˆå‘˜åˆ—è¡¨
            if (!isAdmin && !appData.salesMembers.includes(name)) {
                appData.salesMembers.push(name);
            }
            
            document.getElementById('newPersonName').value = '';
            document.getElementById('newPersonIsAdmin').checked = false;
            renderExistingPersons();
            renderMemberSelector();
            renderSales();
            saveData();
            alert('æ·»åŠ æˆåŠŸï¼');
        }

        function toggleAdmin(index) {
            const member = appData.members[index];
            member.isAdmin = !member.isAdmin;
            
            // å¦‚æœè®¾ä¸ºç®¡ç†å‘˜ï¼Œä»é”€å”®çœ‹æ¿ç§»é™¤
            if (member.isAdmin) {
                appData.salesMembers = appData.salesMembers.filter(name => name !== member.name);
            } else if (!appData.salesMembers.includes(member.name)) {
                // å¦‚æœå–æ¶ˆç®¡ç†å‘˜ï¼Œæ·»åŠ åˆ°é”€å”®çœ‹æ¿
                appData.salesMembers.push(member.name);
            }
            
            renderExistingPersons();
            renderMemberSelector();
            renderTasks();
            renderSales();
            saveData();
        }

        function removePerson(index) {
            if (!confirm('ç¡®å®šåˆ é™¤è¯¥äººå‘˜ï¼Ÿåˆ é™¤åå°†æ— æ³•æ¢å¤ã€‚')) {
                return;
            }
            
            const memberName = appData.members[index].name;
            appData.members.splice(index, 1);
            
            // ä»é”€å”®çœ‹æ¿æˆå‘˜åˆ—è¡¨ç§»é™¤
            appData.salesMembers = appData.salesMembers.filter(name => name !== memberName);
            
            // ä»æ‰€æœ‰æœˆä»½ä¸­åˆ é™¤è¯¥äººå‘˜çš„æ•°æ®
            Object.keys(appData.months).forEach(month => {
                appData.months[month].salesData = appData.months[month].salesData.filter(s => s.name !== memberName);
                
                // ä»ä»»åŠ¡ä¸­ç§»é™¤è¯¥äººå‘˜
                appData.months[month].tasks.forEach(task => {
                    task.members = task.members.filter(m => m !== memberName);
                    if (task.memberCompletion) {
                        delete task.memberCompletion[memberName];
                    }
                });
            });
            
            renderExistingPersons();
            renderMemberSelector();
            renderTasks();
            renderSales();
            saveData();
        }

        // æˆå‘˜é€‰æ‹©å™¨
        function renderMemberSelector() {
            const container = document.getElementById('memberSelector');
            container.innerHTML = appData.members.map(m => `
                <label class="member-checkbox">
                    <input type="checkbox" value="${m.name}">
                    <span>${m.name}${m.isAdmin ? ' ğŸ‘‘' : ''}</span>
                </label>
            `).join('');
        }

        function getSelectedMembers() {
            const checkboxes = document.querySelectorAll('#memberSelector input:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // é”€å”®çœ‹æ¿æˆå‘˜é€‰æ‹©
        function openSelectSalesMembersModal() {
            renderSalesMembersSelector();
            document.getElementById('selectSalesMembersModal').classList.add('active');
        }

        function closeSelectSalesMembersModal() {
            document.getElementById('selectSalesMembersModal').classList.remove('active');
        }

        function renderSalesMembersSelector() {
            const container = document.getElementById('salesMembersSelector');
            // åªæ˜¾ç¤ºéç®¡ç†å‘˜
            const nonAdminMembers = appData.members.filter(m => !m.isAdmin);
            container.innerHTML = nonAdminMembers.map(m => `
                <label class="member-checkbox">
                    <input type="checkbox" 
                           value="${m.name}" 
                           ${appData.salesMembers.includes(m.name) ? 'checked' : ''}>
                    <span>${m.name}</span>
                </label>
            `).join('');
        }

        function saveSalesMembers() {
            const checkboxes = document.querySelectorAll('#salesMembersSelector input:checked');
            appData.salesMembers = Array.from(checkboxes).map(cb => cb.value);
            
            // ç¡®ä¿æ‰€é€‰æˆå‘˜åœ¨salesDataä¸­æœ‰æ•°æ®
            const data = getCurrentData();
            appData.salesMembers.forEach(memberName => {
                if (!data.salesData.find(s => s.name === memberName)) {
                    data.salesData.push({
                        name: memberName,
                        target: 0,
                        order: 0,
                        outbound: 0,
                        return: 0
                    });
                }
            });
            
            // ç§»é™¤æœªé€‰ä¸­çš„æˆå‘˜æ•°æ®
            data.salesData = data.salesData.filter(s => appData.salesMembers.includes(s.name));
            
            saveData();
            renderSales();
            closeSelectSalesMembersModal();
        }

        // ä»»åŠ¡ç®¡ç†
        function openAddTaskModal() {
            document.getElementById('taskContent').value = '';
            document.getElementById('taskDeadline').value = '';
            document.getElementById('taskCategory').value = 'normal';
            document.querySelectorAll('#memberSelector input').forEach(cb => cb.checked = false);
            
            // é‡ç½®æ ‡é¢˜ä¸º"æ·»åŠ ä»»åŠ¡"
            document.querySelector('#addTaskModal .modal-title').textContent = 'æ·»åŠ ä»»åŠ¡';
            
            // é‡ç½®ä¿å­˜æŒ‰é’®
            const saveButton = document.querySelector('#addTaskModal .btn-primary');
            saveButton.onclick = saveNewTask;
            
            document.getElementById('addTaskModal').classList.add('active');
        }

        function closeAddTaskModal() {
            document.getElementById('addTaskModal').classList.remove('active');
        }

        function saveNewTask() {
            const content = document.getElementById('taskContent').value.trim();
            const members = getSelectedMembers();
            const deadline = document.getElementById('taskDeadline').value;
            const category = document.getElementById('taskCategory').value;

            if (!content) {
                alert('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹');
                return;
            }
            if (members.length === 0) {
                alert('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªè´Ÿè´£äºº');
                return;
            }

            const data = getCurrentData();
            
            // åˆå§‹åŒ–æ¯ä¸ªæˆå‘˜çš„å®ŒæˆçŠ¶æ€
            const memberCompletion = {};
            members.forEach(m => memberCompletion[m] = false);
            
            data.tasks.push({
                id: Date.now(),
                content: content,
                members: members,
                deadline: deadline,
                category: category,
                memberCompletion: memberCompletion,
                createdAt: new Date().toISOString()
            });

            saveData();
            renderTasks();
            closeAddTaskModal();
            alert('âœ“ ä»»åŠ¡æ·»åŠ æˆåŠŸï¼');
        }

        // è®¡ç®—ä»»åŠ¡å‰©ä½™å¤©æ•°
        function getDaysLeft(deadline) {
            if (!deadline) return null;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const deadlineDate = new Date(deadline);
            deadlineDate.setHours(0, 0, 0, 0);
            const diff = deadlineDate - today;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }

        // è·å–ä»»åŠ¡é¢œè‰²ç±»
        function getTaskColorClass(deadline) {
            const daysLeft = getDaysLeft(deadline);
            if (daysLeft === null) return '';
            if (daysLeft < 0) return 'days-overdue';
            if (daysLeft <= 2) return 'days-red';
            if (daysLeft < 5) return 'days-yellow';
            return 'days-green';
        }

        // è·å–ä»»åŠ¡æˆªæ­¢æ—¥æœŸæ˜¾ç¤ºæ–‡æœ¬
        function getDeadlineText(deadline) {
            if (!deadline) return 'æ— æˆªæ­¢æ—¥æœŸ';
            
            const daysLeft = getDaysLeft(deadline);
            if (daysLeft === null) return deadline;
            
            if (daysLeft < 0) {
                return `å·²é€¾æœŸ ${-daysLeft} å¤©`;
            } else if (daysLeft === 0) {
                return 'ä»Šå¤©åˆ°æœŸ';
            } else if (daysLeft === 1) {
                return 'æ˜å¤©åˆ°æœŸ';
            } else {
                return `å‰©ä½™ ${daysLeft} å¤©`;
            }
        }

        // æ¸²æŸ“ä»»åŠ¡
        function renderTasks() {
            const data = getCurrentData();
            if (!data) return;

            const containers = {
                urgent: document.getElementById('urgentContainer'),
                important: document.getElementById('importantContainer'),
                normal: document.getElementById('normalContainer')
            };

            Object.values(containers).forEach(c => c.innerHTML = '');

            const stats = {
                total: 0,
                urgent: 0,
                important: 0,
                normal: 0,
                completed: 0,
                overdue: 0
            };

            data.tasks.forEach(task => {
                // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å…¨éƒ¨å®Œæˆ
                const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
                if (allCompleted) {
                    stats.completed++;
                    return; // å·²å®Œæˆçš„ä»»åŠ¡ä¸æ˜¾ç¤º
                }

                stats.total++;
                stats[task.category]++;

                const daysLeft = getDaysLeft(task.deadline);
                if (daysLeft !== null && daysLeft < 0) {
                    stats.overdue++;
                }

                const colorClass = getTaskColorClass(task.deadline);
                const deadlineText = getDeadlineText(task.deadline);

                const memberBadges = task.members.map(m => {
                    const isCompleted = task.memberCompletion && task.memberCompletion[m];
                    const member = appData.members.find(mem => mem.name === m);
                    const isAdmin = member && member.isAdmin;
                    return `<span class="member-badge ${isCompleted ? 'completed' : ''} ${isAdmin ? 'admin' : ''}">${m}${isCompleted ? ' âœ“' : ''}${isAdmin ? ' ğŸ‘‘' : ''}</span>`;
                }).join('');

                const card = document.createElement('div');
                card.className = `task-card ${colorClass}`;
                card.onclick = () => openTaskDetail(task.id);
                card.innerHTML = `
                    <div class="task-content">${task.content}</div>
                    <div class="task-meta">
                        <div class="task-members">${memberBadges}</div>
                        <div class="task-deadline ${colorClass}">${deadlineText}</div>
                    </div>
                `;

                containers[task.category].appendChild(card);
            });

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('totalTasks').textContent = stats.total;
            document.getElementById('urgentTasks').textContent = stats.urgent;
            document.getElementById('importantTasks').textContent = stats.important;
            document.getElementById('normalTasks').textContent = stats.normal;
            document.getElementById('completedTasks').textContent = stats.completed;
            document.getElementById('overdueTasks').textContent = stats.overdue;

            document.getElementById('urgentCount').textContent = stats.urgent;
            document.getElementById('importantCount').textContent = stats.important;
            document.getElementById('normalCount').textContent = stats.normal;
        }

        function openTaskDetail(id) {
            const data = getCurrentData();
            const task = data.tasks.find(t => t.id === id);
            if (!task) return;
            
            currentTask = task;
            
            const daysLeft = getDaysLeft(task.deadline);
            const colorClass = getTaskColorClass(task.deadline);
            let deadlineText = task.deadline || 'æ— æˆªæ­¢æ—¥æœŸ';
            if (daysLeft !== null) {
                deadlineText += ` <span class="task-deadline ${colorClass}">(${getDeadlineText(task.deadline)})</span>`;
            }
            
            const catMap = {urgent: 'ğŸ”¥ ç´§æ€¥', important: 'â­ é‡è¦', normal: 'ğŸ“ ä»»åŠ¡'};
            
            // æˆå‘˜å®ŒæˆçŠ¶æ€
            const memberCompletionHTML = task.members.map(m => {
                const isCompleted = task.memberCompletion && task.memberCompletion[m];
                const member = appData.members.find(mem => mem.name === m);
                const isAdmin = member && member.isAdmin;
                return `
                    <label class="member-completion-item ${isCompleted ? 'completed' : ''}" style="user-select: none;">
                        <input type="checkbox" 
                               class="member-completion-checkbox" 
                               ${isCompleted ? 'checked' : ''} 
                               onchange="toggleMemberCompletion('${m}')">
                        <span style="font-size: 14px; font-weight: 500;">${m}${isAdmin ? ' ğŸ‘‘' : ''}</span>
                    </label>
                `;
            }).join('');

            // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
            const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
            
            document.getElementById('taskDetailContent').innerHTML = `
                <div class="form-group">
                    <label>ä»»åŠ¡å†…å®¹</label>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; white-space: pre-wrap; word-wrap: break-word; word-break: break-word; line-height: 1.8; font-size: 15px;">${task.content}</div>
                </div>
                <div class="form-group">
                    <label>è´Ÿè´£äººå®ŒæˆçŠ¶æ€</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px;">${memberCompletionHTML}</div>
                    ${allCompleted ? '<div style="margin-top: 10px; padding: 8px; background: #d4edda; color: #155724; border-radius: 6px; text-align: center; font-weight: 600; font-size: 14px;">âœ“ æ‰€æœ‰è´Ÿè´£äººå·²å®Œæˆæ­¤ä»»åŠ¡</div>' : ''}
                </div>
                <div class="form-group">
                    <label>æˆªæ­¢æ—¥æœŸ</label>
                    <div style="font-size: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">${deadlineText}</div>
                </div>
                <div class="form-group">
                    <label>ä»»åŠ¡ç±»åˆ«</label>
                    <div style="font-size: 15px; padding: 10px; background: #f8f9fa; border-radius: 6px;">${catMap[task.category]}</div>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>åˆ›å»ºæ—¶é—´</label>
                    <div style="font-size: 14px; color: #666; padding: 10px; background: #f8f9fa; border-radius: 6px;">${new Date(task.createdAt).toLocaleString('zh-CN')}</div>
                </div>
            `;
            
            document.getElementById('taskDetailModal').classList.add('active');
        }

        function toggleMemberCompletion(memberName) {
            if (currentTask) {
                if (!currentTask.memberCompletion) {
                    currentTask.memberCompletion = {};
                }
                currentTask.memberCompletion[memberName] = !currentTask.memberCompletion[memberName];
                saveData();
                renderTasks();
                // é‡æ–°æ‰“å¼€è¯¦æƒ…ä»¥æ›´æ–°æ˜¾ç¤º
                openTaskDetail(currentTask.id);
            }
        }

        function completeAllTask() {
            if (currentTask) {
                if (!currentTask.memberCompletion) {
                    currentTask.memberCompletion = {};
                }
                // å°†æ‰€æœ‰æˆå‘˜æ ‡è®°ä¸ºå®Œæˆ
                currentTask.members.forEach(m => {
                    currentTask.memberCompletion[m] = true;
                });
                saveData();
                renderTasks();
                closeTaskDetailModal();
                alert('âœ“ ä»»åŠ¡å·²å®Œæˆï¼');
            }
        }

        function closeTaskDetailModal() {
            document.getElementById('taskDetailModal').classList.remove('active');
            currentTask = null;
        }

        function editCurrentTask() {
            if (!currentTask) return;
            
            const taskToEdit = currentTask;
            
            document.getElementById('taskContent').value = taskToEdit.content;
            document.getElementById('taskDeadline').value = taskToEdit.deadline || '';
            document.getElementById('taskCategory').value = taskToEdit.category;
            
            document.querySelectorAll('#memberSelector input').forEach(cb => {
                cb.checked = taskToEdit.members.includes(cb.value);
            });
            
            closeTaskDetailModal();
            
            // ä¿®æ”¹æ ‡é¢˜ä¸º"ç¼–è¾‘ä»»åŠ¡"
            document.querySelector('#addTaskModal .modal-title').textContent = 'ç¼–è¾‘ä»»åŠ¡';
            
            document.getElementById('addTaskModal').classList.add('active');
            
            // åˆ›å»ºä¸€ä¸ªæ–°çš„ä¿å­˜å‡½æ•°ç”¨äºç¼–è¾‘
            const editSaveButton = document.querySelector('#addTaskModal .btn-primary');
            const originalOnClick = editSaveButton.onclick;
            
            editSaveButton.onclick = function() {
                const content = document.getElementById('taskContent').value.trim();
                const members = getSelectedMembers();
                const deadline = document.getElementById('taskDeadline').value;
                const category = document.getElementById('taskCategory').value;

                if (!content) {
                    alert('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹');
                    return;
                }
                if (members.length === 0) {
                    alert('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªè´Ÿè´£äºº');
                    return;
                }

                taskToEdit.content = content;
                taskToEdit.deadline = deadline;
                taskToEdit.category = category;
                
                // æ›´æ–°æˆå‘˜åˆ—è¡¨å’Œå®ŒæˆçŠ¶æ€
                taskToEdit.members = members;
                
                // ä¿ç•™æ—§æˆå‘˜çš„å®ŒæˆçŠ¶æ€ï¼Œæ–°æˆå‘˜è®¾ä¸ºæœªå®Œæˆ
                const newCompletion = {};
                members.forEach(m => {
                    newCompletion[m] = (taskToEdit.memberCompletion && taskToEdit.memberCompletion[m]) || false;
                });
                taskToEdit.memberCompletion = newCompletion;

                saveData();
                renderTasks();
                closeAddTaskModal();
                
                // æ¢å¤åŸå§‹çš„ä¿å­˜å‡½æ•°
                editSaveButton.onclick = originalOnClick;
                
                alert('âœ“ ä»»åŠ¡æ›´æ–°æˆåŠŸï¼');
            };
        }

        function deleteCurrentTask() {
            if (currentTask && confirm('ç¡®å®šåˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ')) {
                const data = getCurrentData();
                data.tasks = data.tasks.filter(t => t.id !== currentTask.id);
                saveData();
                renderTasks();
                closeTaskDetailModal();
            }
        }

        // ä»»åŠ¡ç­›é€‰æ˜¾ç¤º
        function showFilteredTasks(filter) {
            const data = getCurrentData();
            if (!data) return;

            let tasks = [];
            const catMap = {urgent: 'ğŸ”¥ ç´§æ€¥', important: 'â­ é‡è¦', normal: 'ğŸ“ ä»»åŠ¡'};
            
            if (filter === 'all') {
                tasks = data.tasks.filter(task => {
                    const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
                    return !allCompleted;
                });
            } else if (filter === 'completed') {
                tasks = data.tasks.filter(task => {
                    const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
                    return allCompleted;
                });
            } else if (filter === 'overdue') {
                tasks = data.tasks.filter(task => {
                    const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
                    if (allCompleted) return false;
                    const daysLeft = getDaysLeft(task.deadline);
                    return daysLeft !== null && daysLeft < 0;
                });
            } else {
                tasks = data.tasks.filter(task => {
                    const allCompleted = task.members.every(m => task.memberCompletion && task.memberCompletion[m]);
                    return !allCompleted && task.category === filter;
                });
            }

            const filterNames = {
                all: 'å…¨éƒ¨ä»»åŠ¡',
                urgent: 'ç´§æ€¥ä»»åŠ¡',
                important: 'é‡è¦ä»»åŠ¡',
                normal: 'æ™®é€šä»»åŠ¡',
                completed: 'å·²å®Œæˆä»»åŠ¡',
                overdue: 'é€¾æœŸä»»åŠ¡'
            };

            document.getElementById('listModalTitle').textContent = filterNames[filter];
            
            const content = document.getElementById('taskListContent');
            if (tasks.length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— ä»»åŠ¡</p>';
            } else {
                content.innerHTML = tasks.map(task => {
                    const colorClass = getTaskColorClass(task.deadline);
                    const deadlineText = getDeadlineText(task.deadline);
                    
                    const memberBadges = task.members.map(m => {
                        const isCompleted = task.memberCompletion && task.memberCompletion[m];
                        const member = appData.members.find(mem => mem.name === m);
                        const isAdmin = member && member.isAdmin;
                        return `<span class="member-badge ${isCompleted ? 'completed' : ''} ${isAdmin ? 'admin' : ''}">${m}${isCompleted ? ' âœ“' : ''}${isAdmin ? ' ğŸ‘‘' : ''}</span>`;
                    }).join('');
                    
                    return `
                        <div class="task-card ${colorClass}" onclick="openTaskDetail(${task.id}); closeTaskListModal();" style="margin-bottom: 10px;">
                            <div class="task-content">${task.content}</div>
                            <div class="task-meta">
                                <div>${catMap[task.category]}</div>
                                <div class="task-members">${memberBadges}</div>
                                <div class="task-deadline ${colorClass}">${deadlineText}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('taskListModal').classList.add('active');
        }

        function closeTaskListModal() {
            document.getElementById('taskListModal').classList.remove('active');
        }

        // ä»»åŠ¡æ’è¡Œï¼ˆæ’é™¤ç®¡ç†å‘˜ï¼‰
        function renderTaskRanking() {
            const data = getCurrentData();
            if (!data) return;

            const memberStats = {};
            // åªç»Ÿè®¡éç®¡ç†å‘˜
            appData.members.filter(m => !m.isAdmin).forEach(m => {
                memberStats[m.name] = { total: 0, completed: 0 };
            });

            data.tasks.forEach(task => {
                task.members.forEach(memberName => {
                    if (memberStats[memberName]) {
                        memberStats[memberName].total++;
                        if (task.memberCompletion && task.memberCompletion[memberName]) {
                            memberStats[memberName].completed++;
                        }
                    }
                });
            });

            const ranking = Object.entries(memberStats)
                .map(([name, stats]) => ({
                    name,
                    completed: stats.completed,
                    total: stats.total,
                    rate: stats.total > 0 ? (stats.completed / stats.total * 100).toFixed(1) : 0
                }))
                .sort((a, b) => b.completed - a.completed);

            const container = document.getElementById('taskRankingList');
            if (ranking.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— æ•°æ®</p>';
            } else {
                container.innerHTML = ranking.map((item, index) => `
                    <div class="rank-item">
                        <div class="rank-number rank-${index < 3 ? index + 1 : 'other'}">
                            ${index + 1}
                        </div>
                        <div class="rank-info">
                            <div class="rank-name">${item.name}</div>
                            <div class="rank-stats">æ€»ä»»åŠ¡: ${item.total} | å®Œæˆç‡: ${item.rate}%</div>
                        </div>
                        <div class="rank-count">${item.completed}</div>
                    </div>
                `).join('');
            }
        }

        // é”€å”®çœ‹æ¿
        function renderSales() {
            const data = getCurrentData();
            if (!data) return;

            document.getElementById('currentDay').value = data.currentDay || 1;
            document.getElementById('totalDays').value = data.totalDays || 30;

            // ç¡®ä¿salesDataåŒ…å«æ‰€æœ‰salesMembers
            appData.salesMembers.forEach(memberName => {
                if (!data.salesData.find(s => s.name === memberName)) {
                    data.salesData.push({
                        name: memberName,
                        target: 0,
                        order: 0,
                        outbound: 0,
                        return: 0
                    });
                }
            });

            // åªæ˜¾ç¤ºsalesMembersä¸­çš„æˆå‘˜
            const displayData = data.salesData.filter(s => appData.salesMembers.includes(s.name));

            const tbody = document.getElementById('salesBody');
            tbody.innerHTML = displayData.map(member => `
                <tr>
                    <td style="font-weight: 600;">${member.name}</td>
                    <td><input type="number" value="${member.target}" onchange="updateSalesValue('${member.name}', 'target', this.value)"></td>
                    <td><input type="number" value="${member.order}" onchange="updateSalesValue('${member.name}', 'order', this.value)"></td>
                    <td><input type="number" value="${member.outbound}" onchange="updateSalesValue('${member.name}', 'outbound', this.value)"></td>
                    <td><input type="number" value="${member.return}" onchange="updateSalesValue('${member.name}', 'return', this.value)"></td>
                    <td id="net_${member.name}">0</td>
                    <td id="rate_${member.name}">0%</td>
                    <td id="remain_${member.name}">0</td>
                    <td id="daily_${member.name}">0</td>
                    <td id="status_${member.name}"></td>
                    <td>
                        <button class="btn btn-danger" style="padding: 4px 12px; font-size: 12px;" onclick="removeSalesMember('${member.name}')">ç§»é™¤</button>
                    </td>
                </tr>
            `).join('');

            calculateSales();
        }

        function removeSalesMember(memberName) {
            if (!confirm(`ç¡®å®šä»é”€å”®çœ‹æ¿ç§»é™¤ ${memberName}ï¼Ÿ`)) {
                return;
            }
            appData.salesMembers = appData.salesMembers.filter(name => name !== memberName);
            saveData();
            renderSales();
        }

        function updateSalesValue(memberName, field, value) {
            const data = getCurrentData();
            const member = data.salesData.find(m => m.name === memberName);
            if (member) {
                member[field] = parseFloat(value) || 0;
                calculateSales();
                saveData();
            }
        }

        function calculateSales() {
            const data = getCurrentData();
            if (!data) return;

            data.currentDay = parseInt(document.getElementById('currentDay').value) || 1;
            data.totalDays = parseInt(document.getElementById('totalDays').value) || 30;

            let totals = {
                target: 0,
                order: 0,
                outbound: 0,
                return: 0,
                net: 0
            };

            const displayData = data.salesData.filter(s => appData.salesMembers.includes(s.name));

            displayData.forEach(member => {
                const net = member.outbound - member.return;
                const rate = member.target > 0 ? (net / member.target * 100).toFixed(1) : 0;
                const remain = member.target - net;
                const remainDays = data.totalDays - data.currentDay;
                const daily = remainDays > 0 ? (remain / remainDays).toFixed(0) : 0;

                document.getElementById(`net_${member.name}`).textContent = net.toFixed(0);
                document.getElementById(`rate_${member.name}`).textContent = rate + '%';
                document.getElementById(`remain_${member.name}`).textContent = remain.toFixed(0);
                document.getElementById(`daily_${member.name}`).textContent = daily;

                let statusHTML = '';
                if (rate >= 100) {
                    statusHTML = '<span class="status-badge status-good">å·²è¾¾æ ‡</span>';
                } else if (rate >= 80) {
                    statusHTML = '<span class="status-badge status-warning">æ¥è¿‘ç›®æ ‡</span>';
                } else {
                    statusHTML = '<span class="status-badge status-danger">éœ€åŠªåŠ›</span>';
                }
                document.getElementById(`status_${member.name}`).innerHTML = statusHTML;

                totals.target += member.target;
                totals.order += member.order;
                totals.outbound += member.outbound;
                totals.return += member.return;
                totals.net += net;
            });

            const totalRate = totals.target > 0 ? (totals.net / totals.target * 100).toFixed(1) : 0;

            document.getElementById('totalTarget').textContent = totals.target.toFixed(0);
            document.getElementById('totalOrder').textContent = totals.order.toFixed(0);
            document.getElementById('totalOutbound').textContent = totals.outbound.toFixed(0);
            document.getElementById('totalReturn').textContent = totals.return.toFixed(0);
            document.getElementById('totalNet').textContent = totals.net.toFixed(0);
            document.getElementById('totalRate').textContent = totalRate + '%';

            saveData();
        }

        // é”€å”®åˆ†æï¼ˆæ’é™¤ç®¡ç†å‘˜ï¼‰
        function renderSalesAnalysis() {
            const data = getCurrentData();
            if (!data) return;

            // åªåˆ†æsalesMembersä¸­çš„æˆå‘˜
            const displayData = data.salesData.filter(s => appData.salesMembers.includes(s.name));

            const rates = displayData.map(member => {
                const net = member.outbound - member.return;
                return member.target > 0 ? (net / member.target * 100) : 0;
            });

            const maxRate = rates.length > 0 ? Math.max(...rates).toFixed(1) : 0;
            const avgRate = rates.length > 0 ? (rates.reduce((a, b) => a + b, 0) / rates.length).toFixed(1) : 0;
            const achievedCount = rates.filter(r => r >= 100).length;
            
            const totalTarget = displayData.reduce((sum, m) => sum + m.target, 0);
            const totalNet = displayData.reduce((sum, m) => sum + (m.outbound - m.return), 0);
            const teamRate = totalTarget > 0 ? (totalNet / totalTarget * 100).toFixed(1) : 0;

            document.getElementById('maxRate').textContent = maxRate + '%';
            document.getElementById('avgRate').textContent = avgRate + '%';
            document.getElementById('achievedCount').textContent = achievedCount;
            document.getElementById('teamRate').textContent = teamRate + '%';

            // é”€å”®æ’è¡Œ
            const ranking = displayData.map(member => {
                const net = member.outbound - member.return;
                const rate = member.target > 0 ? (net / member.target * 100).toFixed(1) : 0;
                return { name: member.name, net, rate };
            }).sort((a, b) => b.net - a.net);

            const container = document.getElementById('salesRankingList');
            if (ranking.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æš‚æ— æ•°æ®</p>';
            } else {
                container.innerHTML = ranking.map((item, index) => `
                    <div class="rank-item">
                        <div class="rank-number rank-${index < 3 ? index + 1 : 'other'}">
                            ${index + 1}
                        </div>
                        <div class="rank-info">
                            <div class="rank-name">${item.name}</div>
                            <div class="rank-stats">å®Œæˆç‡: ${item.rate}%</div>
                        </div>
                        <div class="rank-count">${item.net.toFixed(0)}</div>
                    </div>
                `).join('');
            }
        }

        // å¯åŠ¨åº”ç”¨
        window.onload = init;
    </script>
</body>
</html>
